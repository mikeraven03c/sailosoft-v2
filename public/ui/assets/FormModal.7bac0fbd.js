import{aR as Z,r as v,aQ as A,c as re,y as se,ah as le,A as ie,aj as ce,a as I,h as E,W as ue,g as de,a_ as G,f as fe,a$ as me,b0 as pe,am as ve,a2 as P,a3 as k,a4 as w,a8 as d,b1 as he,b2 as ge,b3 as K,af as X,ab as ye,ag as be,ad as S,a9 as Q,H as L,$,aZ as Ce,b4 as we,b5 as Fe,b6 as Se,b7 as _e}from"./index.62a56d21.js";import{Q as Ee}from"./QSpace.c6f2a2c6.js";function Pe(){return{reloadPageUnauthenticated(e){e.response.status==401&&(alert("You are not authenticated. Please login."),window.location.reload())}}}function W(){function e({error:n,formError:a}){const r=Z().errorNotify,{reloadPageUnauthenticated:l}=Pe();if(n.response){let c=n.response;if(l(n),c.status===422){let s=c.data;const{message:u,errors:h}=o(s);a.value=h,r("Please check the following fields:<br>"+u)}else r(n.response.data.message)}else r("There is error when saving a record."),console.error(n)}function o(n){let a="",r={},l=1;for(const[c,s]of Object.entries(n))if(s.length>0){let u=s.join(", ");a+="<br> "+l+". "+u,l++,r[c]=u}return{message:a,errors:r}}return{handleError:e}}const F="new",ke="edit",xe="show",ee="onCreate",te="onUpdate",De=[ee,te];function qe({title:e,url:o,initialValues:n={}}){const a=v(),r=v(!1),l=v(!1),c=v(!1),s=v({}),u=v({}),h=v({}),f=v(F),H=Z(),b={formProcessing:{start:()=>r.value=!0,stop:()=>r.value=!1},formMode:{isCreate:()=>f.value==F,isUpdate:()=>f.value==ke,isShow:()=>f.value==xe},form:{create:x,edit:D,show:N},formData:{update:t=>s.value=O(t)}},m={beforeOpenForm:t=>t,beforeCreate:t=>t,beforeUpdate:t=>t,afterResolve:t=>t,afterCreate:t=>{},afterUpdate:t=>{},resolveCreate:t=>{},resolveUpdate:t=>{}},q={form:a,formShow:l,formReadonly:c,formData:s,formProcessing:r,formError:h,formMode:f,formEmit:De,formDefaultData:u};function z(t={}){const{emit:p=C=>{},token:g}=t;if(B())console.info("Can not process");else{b.formProcessing.start();const C=oe(),y=R({mode:F,fields:C});A.post(o,y).then(({data:i})=>{p(i),m.afterCreate(i),H.saveNotify({mode:"Created",title:e}),l.value=!1,b.formProcessing.stop(),m.resolveCreate(i)}).catch(i=>{W().handleError({error:i,formError:h,formProcessing:r}),b.formProcessing.stop()})}}function T(t={}){const{emit:p=i=>{},id:g=null}=t;if(B()){console.info("Can not process");return}b.formProcessing.start();const C=s.value,y=R({mode:F,fields:C});A.put(o+"/"+(g||s.value.id),y).then(({data:i})=>{p(i),m.afterUpdate(i),H.saveNotify({mode:"Saved",title:e}),l.value=!1,b.formProcessing.stop(),m.resolveUpdate(i)}).catch(i=>{W().handleError({error:i,formError:h,formProcessing:r}),b.formProcessing.stop()})}function oe(){return s.value}function B(){return r.value}function R({mode:t=F,fields:p={}}){let g=p;return t==F?g=m.beforeCreate(p):g=m.beforeUpdate(p),m.afterResolve(g)}function x(){f.value="new",s.value=O(n),c.value=!1,U()}function D(t){U(),f.value="edit",c.value=!1,s.value=m.beforeOpenForm(j(t))}function N(t){U(),f.value="show",c.value=!0,s.value=m.beforeOpenForm(j(t))}function U(){h.value={},l.value=!0,r.value=!1}function j(t){return{...n,...O(t)}}function ne(t){function p(y={}){z(C(ee,y))}function g(y={}){T(C(te,y))}function C(y,i){return{...i,emit:_=>{(i.emit||(()=>{}))(_),t(y,_)}}}return{onFormCreate:p,onFormUpdate:g}}function O(t){return JSON.parse(JSON.stringify(t))}function ae(){return{create:x,edit:D,show:N}}return{...q,reference:q,exposedFormFunction:{create:x,edit:D,show:N},hooksCycle:m,actions:b,getActions:()=>b,onCreate:z,onUpdate:T,exposeFormFunction:ae,handleFormEmit:ne}}function ze(){const e=v();return{form:e,onFormNew:()=>e.value.create(),onFormEdit:o=>e.value.edit(o),onFormShow:o=>e.value.show(o)}}var Ne=re({name:"QInnerLoading",props:{...se,...le,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const n=de(),a=ie(e,n.proxy.$q),{transitionProps:r,transitionStyle:l}=ce(e),c=I(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(a.value===!0?" q-inner-loading--dark":"")),s=I(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function u(){const f=[E(G,{size:e.size,color:e.color})];return e.label!==void 0&&f.push(E("div",{class:s.value,style:e.labelStyle},[e.label])),f}function h(){return e.showing===!0?E("div",{class:c.value,style:l.value},o.default!==void 0?o.default():u()):null}return()=>E(ue,r.value,h)}});function V(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const o=parseInt(e,10);return isNaN(o)?0:o}var J=fe({name:"close-popup",beforeMount(e,{value:o}){const n={depth:V(o),handler(a){n.depth!==0&&setTimeout(()=>{const r=me(e);r!==void 0&&pe(r,a,n.depth)})},handlerKey(a){ve(a,13)===!0&&n.handler(a)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:o,oldValue:n}){o!==n&&(e.__qclosepopup.depth=V(o))},beforeUnmount(e){const o=e.__qclosepopup;e.removeEventListener("click",o.handler),e.removeEventListener("keyup",o.handlerKey),delete e.__qclosepopup}});const Ue={class:"text-h6"},Oe=X("span",{class:"text-primary"},"Processing ...",-1),Y="new",M="show",Te={__name:"FormModal",props:{isShow:{type:Boolean,default:!1},formStyle:{type:String,default:"width: 500px; max-width:90vw;"},title:String,mode:{type:String,default:"new"},loading:{type:Boolean,default:!1}},emits:["onCreate","onUpdate"],setup(e,{emit:o}){const{capitalize:n}=_e,a=e,r=o,l=v(!1);function c(){a.mode==Y?r("onCreate"):r("onUpdate")}return(s,u)=>(P(),k(Se,{persistent:"",maximized:l.value},{default:w(()=>[d(he,{style:ge(l.value?"":e.formStyle),class:"relative"},{default:w(()=>[d(K,{class:"row items-center q-pb-none"},{default:w(()=>[X("div",Ue,ye(be(n)(a.mode)+" "+a.title),1),d(Ee),e.mode!="show"?(P(),k(S,{key:0,icon:"save",flat:"",round:"",dense:"",onClick:c})):Q("",!0),d(S,{icon:"fullscreen",flat:"",round:"",dense:"",onClick:u[0]||(u[0]=()=>l.value=!l.value)}),L(d(S,{icon:"close",flat:"",round:"",dense:""},null,512),[[J]])]),_:1}),d($,{inset:""}),d(K,null,{default:w(()=>[Ce(s.$slots,"form")]),_:3}),d($,{inset:""}),d(we,{align:"right"},{default:w(()=>[a.mode!=M?L((P(),k(S,{key:0,flat:"",label:"Cancel",color:"primary"},null,512)),[[J]]):Q("",!0),a.mode!=M?(P(),k(S,{key:1,flat:"",onClick:c,onKeyup:u[1]||(u[1]=Fe(h=>s.prompt=!1,["enter"])),color:"primary",disable:a.mode==M,label:a.mode==Y?"Create":"Update"},null,8,["disable","label"])):Q("",!0)]),_:1}),d(Ne,{showing:a.loading},{default:w(()=>[d(G,{size:"3em",thickness:2,color:"primary"}),Oe]),_:1},8,["showing"])]),_:3},8,["style"])]),_:3},8,["maximized"]))}};export{J as C,ze as F,Ne as Q,Te as _,qe as a,De as f};
