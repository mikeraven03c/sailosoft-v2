import{aP as Y,r as v,aO as L,c as re,f as se,a8 as le,k as ie,aa as ce,a as R,h as E,T as ue,g as de,aW as Z,as as fe,aX as me,aY as pe,af as ve,V as P,W as k,X as w,$ as d,aZ as he,aQ as ge,a_ as W,a6 as G,a2 as ye,a7 as be,a4 as S,a0 as Q,v as $,Q as j,aV as Ce,a$ as we,b0 as Fe,b1 as Se,b2 as _e}from"./index.d510ed45.js";import{Q as Ee}from"./QSpace.6f68aa3e.js";function Pe(){return{reloadPageUnauthenticated(e){e.response.status==401&&(alert("You are not authenticated. Please login."),window.location.reload())}}}function A(){function e({error:a,formError:n}){const r=Y().errorNotify,{reloadPageUnauthenticated:l}=Pe();if(a.response){let c=a.response;if(l(a),c.status===422){let s=c.data;const{message:u,errors:h}=o(s);n.value=h,r("Please check the following fields:<br>"+u)}else r(a.response.data.message)}else r("There is error when saving a record."),console.error(a)}function o(a){let n="",r={},l=1;for(const[c,s]of Object.entries(a))if(s.length>0){let u=s.join(", ");n+="<br> "+l+". "+u,l++,r[c]=u}return{message:n,errors:r}}return{handleError:e}}const F="new",ke="edit",xe="show",ee="onCreate",te="onUpdate",De=[ee,te];function He({title:e,url:o,initialValues:a={}}){const n=v(),r=v(!1),l=v(!1),c=v(!1),s=v({}),u=v({}),h=v({}),f=v(F),q=Y(),b={formProcessing:{start:()=>r.value=!0,stop:()=>r.value=!1},formMode:{isCreate:()=>f.value==F,isUpdate:()=>f.value==ke,isShow:()=>f.value==xe},form:{create:x,edit:D,show:N},formData:{update:t=>s.value=U(t)}},m={beforeOpenForm:t=>t,beforeCreate:t=>t,beforeUpdate:t=>t,afterResolve:t=>t,afterCreate:t=>{},afterUpdate:t=>{},resolveCreate:t=>{},resolveUpdate:t=>{}},H={form:n,formShow:l,formReadonly:c,formData:s,formProcessing:r,formError:h,formMode:f,formEmit:De,formDefaultData:u};function T(t={}){const{emit:p=C=>{},token:g}=t;if(B())console.info("Can not process");else{b.formProcessing.start();const C=oe(),y=I({mode:F,fields:C});L.post(o,y).then(({data:i})=>{p(i),m.afterCreate(i),q.saveNotify({mode:"Created",title:e}),l.value=!1,b.formProcessing.stop(),m.resolveCreate(i)}).catch(i=>{A().handleError({error:i,formError:h,formProcessing:r}),b.formProcessing.stop()})}}function z(t={}){const{emit:p=i=>{},id:g=null}=t;if(B()){console.info("Can not process");return}b.formProcessing.start();const C=s.value,y=I({mode:F,fields:C});L.put(o+"/"+(g||s.value.id),y).then(({data:i})=>{p(i),m.afterUpdate(i),q.saveNotify({mode:"Saved",title:e}),l.value=!1,b.formProcessing.stop(),m.resolveUpdate(i)}).catch(i=>{A().handleError({error:i,formError:h,formProcessing:r}),b.formProcessing.stop()})}function oe(){return s.value}function B(){return r.value}function I({mode:t=F,fields:p={}}){let g=p;return t==F?g=m.beforeCreate(p):g=m.beforeUpdate(p),m.afterResolve(g)}function x(){f.value="new",s.value=U(a),c.value=!1,O()}function D(t){O(),f.value="edit",c.value=!1,s.value=m.beforeOpenForm(K(t))}function N(t){O(),f.value="show",c.value=!0,s.value=m.beforeOpenForm(K(t))}function O(){h.value={},l.value=!0,r.value=!1}function K(t){return{...a,...U(t)}}function ae(t){function p(y={}){T(C(ee,y))}function g(y={}){z(C(te,y))}function C(y,i){return{...i,emit:_=>{(i.emit||(()=>{}))(_),t(y,_)}}}return{onFormCreate:p,onFormUpdate:g}}function U(t){return JSON.parse(JSON.stringify(t))}function ne(){return{create:x,edit:D,show:N}}return{...H,reference:H,exposedFormFunction:{create:x,edit:D,show:N},hooksCycle:m,actions:b,getActions:()=>b,onCreate:T,onUpdate:z,exposeFormFunction:ne,handleFormEmit:ae}}function Te(){const e=v();return{form:e,onFormNew:()=>e.value.create(),onFormEdit:o=>e.value.edit(o),onFormShow:o=>e.value.show(o)}}var Ne=re({name:"QInnerLoading",props:{...se,...le,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:o}){const a=de(),n=ie(e,a.proxy.$q),{transitionProps:r,transitionStyle:l}=ce(e),c=R(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(n.value===!0?" q-inner-loading--dark":"")),s=R(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function u(){const f=[E(Z,{size:e.size,color:e.color})];return e.label!==void 0&&f.push(E("div",{class:s.value,style:e.labelStyle},[e.label])),f}function h(){return e.showing===!0?E("div",{class:c.value,style:l.value},o.default!==void 0?o.default():u()):null}return()=>E(ue,r.value,h)}});function V(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const o=parseInt(e,10);return isNaN(o)?0:o}var J=fe({name:"close-popup",beforeMount(e,{value:o}){const a={depth:V(o),handler(n){a.depth!==0&&setTimeout(()=>{const r=me(e);r!==void 0&&pe(r,n,a.depth)})},handlerKey(n){ve(n,13)===!0&&a.handler(n)}};e.__qclosepopup=a,e.addEventListener("click",a.handler),e.addEventListener("keyup",a.handlerKey)},updated(e,{value:o,oldValue:a}){o!==a&&(e.__qclosepopup.depth=V(o))},beforeUnmount(e){const o=e.__qclosepopup;e.removeEventListener("click",o.handler),e.removeEventListener("keyup",o.handlerKey),delete e.__qclosepopup}});const Oe={class:"text-h6"},Ue=G("span",{class:"text-primary"},"Processing ...",-1),X="new",M="show",ze={__name:"FormModal",props:{isShow:{type:Boolean,default:!1},formStyle:{type:String,default:"width: 500px; max-width:90vw;"},title:String,mode:{type:String,default:"new"},loading:{type:Boolean,default:!1}},emits:["onCreate","onUpdate"],setup(e,{emit:o}){const{capitalize:a}=_e,n=e,r=o,l=v(!1);function c(){n.mode==X?r("onCreate"):r("onUpdate")}return(s,u)=>(P(),k(Se,{persistent:"",maximized:l.value},{default:w(()=>[d(he,{style:ge(l.value?"":e.formStyle),class:"relative"},{default:w(()=>[d(W,{class:"row items-center q-pb-none"},{default:w(()=>[G("div",Oe,ye(be(a)(n.mode)+" "+n.title),1),d(Ee),e.mode!="show"?(P(),k(S,{key:0,icon:"save",flat:"",round:"",dense:"",onClick:c})):Q("",!0),d(S,{icon:"fullscreen",flat:"",round:"",dense:"",onClick:u[0]||(u[0]=()=>l.value=!l.value)}),$(d(S,{icon:"close",flat:"",round:"",dense:""},null,512),[[J]])]),_:1}),d(j,{inset:""}),d(W,null,{default:w(()=>[Ce(s.$slots,"form")]),_:3}),d(j,{inset:""}),d(we,{align:"right"},{default:w(()=>[n.mode!=M?$((P(),k(S,{key:0,flat:"",label:"Cancel",color:"primary"},null,512)),[[J]]):Q("",!0),n.mode!=M?(P(),k(S,{key:1,flat:"",onClick:c,onKeyup:u[1]||(u[1]=Fe(h=>s.prompt=!1,["enter"])),color:"primary",disable:n.mode==M,label:n.mode==X?"Create":"Update"},null,8,["disable","label"])):Q("",!0)]),_:1}),d(Ne,{showing:n.loading},{default:w(()=>[d(Z,{size:"3em",thickness:2,color:"primary"}),Ue]),_:1},8,["showing"])]),_:3},8,["style"])]),_:3},8,["maximized"]))}};export{J as C,Te as F,Ne as Q,ze as _,He as a,De as f};
