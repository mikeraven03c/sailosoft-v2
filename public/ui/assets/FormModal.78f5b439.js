import{aF as L,r as m,aG as I,c as ae,y as ne,ag as re,A as se,ai as le,a as R,h as P,V as ie,g as ce,aH as G,a1 as k,a2 as N,a3 as S,a7 as f,aI as ue,aJ as fe,aK as V,ae as Y,aa as de,af as me,ac as b,a8 as O,G as j,_ as W,aE as ve,aL as ge,aM as pe,aN as he}from"./index.74d7f585.js";import{Q as ye}from"./QSpace.19d9814e.js";import{C as $}from"./ClosePopup.f0cb9b11.js";import{j as Ce}from"./format.08b9b864.js";function we(){return{reloadPageUnauthenticated(e){e.response.status==401&&(alert("You are not authenticated. Please login."),window.location.reload())}}}function J(){function e({error:i,formError:a}){const o=L().errorNotify,{reloadPageUnauthenticated:r}=we();if(i.response){let s=i.response;if(r(i),s.status===422){let n=s.data;const{message:c,errors:v}=l(n);a.value=v,o("Please check the following fields:<br>"+c)}else o(i.response.data.message)}else o("There is error when saving a record."),console.error(i)}function l(i){let a="",o={},r=1;for(const[s,n]of Object.entries(i))if(n.length>0){let c=n.join(", ");a+="<br> "+r+". "+c,r++,o[s]=c}return{message:a,errors:o}}return{handleError:e}}const F="new",Se="edit",Fe="show",X="onCreate",Z="onUpdate",be=[X,Z];function Oe({title:e,url:l,initialValues:i={}}){const a=m(),o=m(!1),r=m(!1),s=m(!1),n=m({}),c=m({}),v=m({}),d=m(F),Q=L(),y={formProcessing:{start:()=>o.value=!0,stop:()=>o.value=!1},formMode:{isCreate:()=>d.value==F,isUpdate:()=>d.value==Se,isShow:()=>d.value==Fe},form:{create:_,edit:D}},w={beforeCreate:t=>t,beforeUpdate:t=>t,afterResolve:t=>t,afterCreate:t=>{},afterUpdate:t=>{}},H={form:a,formShow:r,formReadonly:s,formData:n,formProcessing:o,formError:v,formMode:d,formEmit:be,formDefaultData:c};function z(t={}){const{emit:g=C=>{},token:p}=t;if(B())console.info("Can not process");else{y.formProcessing.start();const C=ee(),h=q({mode:F,fields:C});I.post(l,h).then(({data:u})=>{g(u),w.afterCreate(u),Q.saveNotify({mode:"Created",title:e}),r.value=!1,y.formProcessing.stop()}).catch(u=>{J().handleError({error:u,formError:v,formProcessing:o}),y.formProcessing.stop()})}}function T(t={}){const{emit:g=u=>{},id:p=null}=t;if(B()){console.info("Can not process");return}y.formProcessing.start();const C=n.value,h=q({mode:F,fields:C});I.put(l+"/"+(p||n.value.id),h).then(({data:u})=>{g(u),w.afterUpdate(u),Q.saveNotify({mode:"Saved",title:e}),r.value=!1,y.formProcessing.stop()}).catch(u=>{J().handleError({error:u,formError:v,formProcessing:o}),y.formProcessing.stop()})}function ee(){return n.value}function B(){return o.value}function q({mode:t=F,fields:g={}}){let p=g;return t==F?p=w.beforeCreate(g):p=w.beforeUpdate(g),w.afterResolve(p)}function _(){d.value="new",n.value=x(i),s.value=!1,U()}function D(t){U(),d.value="edit",s.value=!1,n.value=x(t)}function A(t){U(),d.value="show",s.value=!0,n.value=x(t)}function U(){v.value={},r.value=!0,o.value=!1}function te(t){function g(h={}){z(C(X,h))}function p(h={}){T(C(Z,h))}function C(h,u){return{...u,emit:E=>{(u.emit||(()=>{}))(E),t(h,E)}}}return{onFormCreate:g,onFormUpdate:p}}function x(t){return JSON.parse(JSON.stringify(t))}function oe(){return{create:_,edit:D,show:A}}return{...H,reference:H,exposedFormFunction:{create:_,edit:D,show:A},hooksCycle:w,actions:y,getActions:()=>y,onCreate:z,onUpdate:T,exposeFormFunction:oe,handleFormEmit:te}}function Me(){const e=m();return{form:e,onFormNew:()=>e.value.create(),onFormEdit:l=>e.value.edit(l),onFormShow:l=>e.value.show(l)}}var Ee=ae({name:"QInnerLoading",props:{...ne,...re,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:l}){const i=ce(),a=se(e,i.proxy.$q),{transitionProps:o,transitionStyle:r}=le(e),s=R(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(a.value===!0?" q-inner-loading--dark":"")),n=R(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function c(){const d=[P(G,{size:e.size,color:e.color})];return e.label!==void 0&&d.push(P("div",{class:n.value,style:e.labelStyle},[e.label])),d}function v(){return e.showing===!0?P("div",{class:s.value,style:r.value},l.default!==void 0?l.default():c()):null}return()=>P(ie,o.value,v)}});const Pe={class:"text-h6"},ke=Y("span",{class:"text-primary"},"Processing ...",-1),K="new",M="show",Qe={__name:"FormModal",props:{isShow:{type:Boolean,default:!1},formStyle:{type:String,default:"width: 500px; max-width:90vw;"},title:String,mode:{type:String,default:"new"},loading:{type:Boolean,default:!1}},emits:["onCreate","onUpdate"],setup(e,{emit:l}){const{capitalize:i}=Ce,a=e,o=l,r=m(!1);function s(){a.mode==K?o("onCreate"):o("onUpdate")}return(n,c)=>(k(),N(he,{persistent:"",maximized:r.value},{default:S(()=>[f(ue,{style:fe(r.value?"":e.formStyle),class:"relative"},{default:S(()=>[f(V,{class:"row items-center q-pb-none"},{default:S(()=>[Y("div",Pe,de(me(i)(a.mode)+" "+a.title),1),f(ye),e.mode!="show"?(k(),N(b,{key:0,icon:"save",flat:"",round:"",dense:"",onClick:s})):O("",!0),f(b,{icon:"fullscreen",flat:"",round:"",dense:"",onClick:c[0]||(c[0]=()=>r.value=!r.value)}),j(f(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),f(W,{inset:""}),f(V,null,{default:S(()=>[ve(n.$slots,"form")]),_:3}),f(W,{inset:""}),f(ge,{align:"right"},{default:S(()=>[a.mode!=M?j((k(),N(b,{key:0,flat:"",label:"Cancel",color:"primary"},null,512)),[[$]]):O("",!0),a.mode!=M?(k(),N(b,{key:1,flat:"",onClick:s,onKeyup:c[1]||(c[1]=pe(v=>n.prompt=!1,["enter"])),color:"primary",disable:a.mode==M,label:a.mode==K?"Create":"Update"},null,8,["disable","label"])):O("",!0)]),_:1}),f(Ee,{showing:a.loading},{default:S(()=>[f(G,{size:"3em",thickness:2,color:"primary"}),ke]),_:1},8,["showing"])]),_:3},8,["style"])]),_:3},8,["maximized"]))}};export{Me as F,Ee as Q,Qe as _,Oe as a,be as f};
